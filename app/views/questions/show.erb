<% if logged_in? %>
  <% if @question.user_has_voted?(current_user) %>
    <form method="post" action="/votes/<%= @question.get_vote_id(current_user) %>">
      <input type="hidden" name="_method" value="put">
      <button type="submit" name="vote" class= "triangle-up" value="1">upvote</button>
      <button type="submit" name="vote" class= "triangle-down" value="-1">downvote</button>
    </form>
  <% else %>
    <form method="post" action="/votes" >
      <input type="hidden" name="question_id" value="<%= @question.id %>">
      <button type="submit" name="vote" class= "triangle-up" value="1">upvote</button>
      <button type="submit" name="vote" class="triangle-down" value="-1">downvote</button>
    </form>
  <% end %>
<% end %>

<p><%= @question.total_votes %></p>
<h3><%= @question.title %></h3>
<p><%= @question.body %> </p>
<p><%= @question.user.username %></p>

<% if allowed?(@question) %>
  <form method="post" action="/questions/<%= @question.id %>">
    <input type="hidden" name="_method" value="put">
    <button type="submit">edit question</button>
  </form>
<% end %>

<% if allowed?(@question) %>
 <form method="post" action="/questions/<%= @question.id %>">
  <%= erb :'/_delete' %>
 </form>
<% end %>

<% @question.comments.each do |comment| %>
  <p> <%= comment.text %> </p>
  <p> <%= comment.user.username %> </p>

  <% if allowed?(comment) %>
    <form method="post" action="/questions/<%= @question.id %>/comments/<%= comment.id%>">
    <%= erb :'/_delete' %>
    </form>
  <% end %>
<% end %>
<form method="post" action="/questions/<%= @question.id %>/comments">
<%= erb :"_addcomments" %>
<button name="commentable" type="submit" value="<%= @question.id %>">Submit your comment</button>
</form>


<% @answers.each do |answer| %>
  <p><%= answer.text %></p>
  <p><%= answer.total_votes %></p>
  <p><strong><%= answer.user.username %></strong></p>

  <% if allowed?(@question) %>
      <form method="post" action="/answers/<%= answer.id %>">
      <input type="hidden" name="_method" value="put">
      <button type="submit">edit answer</button>
    </form>
  <% end %>

  <% if allowed?(answer) %>
    <form method="post" action="/answers/<%= answer.id %>">
    <%= erb :'/_delete' %>
    </form>
  <% end %>

  <% answer.comments.each do |comment| %>
    <p> <%= comment.text %> </p>
    <p><strong><%= comment.user.username %></strong></p>

    <% if allowed?(comment) %>
      <form method="post" action="/answers/<%= answer.id %>/comments/<%= comment.id%>">
      <%= erb :'/_delete' %>
      </form>

    <% end %>
  <% end %>

  <form method="post" action="/answers/<%= answer.id %>/comments">
  <%= erb :"_addcomments" %>
  <button name="commentable" type="submit" value="<%= answer.id %>">Submit your comment</button>
  </form>

  <% if logged_in? %>
    <% if answer.user_has_voted?(current_user) %>
      <form method="post" action="/votes/<%= answer.get_vote_id(current_user) %>">
        <input type="hidden" name="_method" value="put">
        <button type="submit" name="vote" class= "triangle-up" value="1">upvote</button>
        <button type="submit" name="vote" class="triangle-down" value="-1">downvote</button>
      </form>
    <% else %>
      <form method="post" action="/votes" >
        <input type="hidden" name="answer_id" value="<%= answer.id %>">
        <button type="submit" name="vote" class= "triangle-up" value="1">upvote</button>
        <button type="submit" name="vote" class="triangle-down" value="-1">downvote</button>
      </form>
    <% end %>
  <% end %>
<% end %>
<form method="post" action="/answers">
  <label for="text">Add your answer</label>
  <br>
  <input id="text_input" name="answer[text]" type="text">
  <br>
  <button name="question" type="submit" value="<%= @question.id %>">Submit answer</button>
</form>


